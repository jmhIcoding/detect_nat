__author__ = 'dell'
import requests
import sys
import time
import threading
import random
sem=threading.Semaphore(5)
semMost=None
url="http://118.190.80.87"

def get_url(url,timeout):
    global  sem
    global semMost
    state=sem.acquire()
    semMost.acquire()
    requests.get(url)
    sem.release()
if __name__ == '__main__':
    if len(sys.argv)!=3:
        print("auto_runing.py 1000(times) 0.5(sleep)")
        exit(-1)
    
    semMost=threading.Semaphore(int(sys.argv[1]))
    i=0
    threads=[]
    for i in range(int(sys.argv[1])):
        th=threading.Thread(target=get_url,args=(url,float(sys.argv[2])))
        th.start()
        threads.append(th)
        print(i)
        if random.randint(1,10)<3:
            print("sleeping")
            time.sleep(random.uniform(0.2,float(sys.argv[2])))
    for each in threads:
        each.join()

